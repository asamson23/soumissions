function detectIE(){var e=window.navigator.userAgent,t=e.indexOf("MSIE ");if(t>0)return parseInt(e.substring(t+5,e.indexOf(".",t)),10);if(e.indexOf("Trident/")>0){var i=e.indexOf("rv:");return parseInt(e.substring(i+3,e.indexOf(".",i)),10)}var o=e.indexOf("Edge/");return o>0&&parseInt(e.substring(o+5,e.indexOf(".",o)),10)}var m=window.m,_=window._,titleCase=window.titleCase,createPDF=window.createPDF,zFill=window.zFill=function(e){return("0"+e).slice(-2)},serializeFieldSet=function(e){var t={};return Object.keys(e).forEach(function(i){t[i]=e[i].value}),t},deserializeFieldSet=function(e,t){Object.keys(e).forEach(function(i){t[i]&&(t[i].value=e[i],t[i].valid=null)})},resetValidation=function(e){Object.keys(e).forEach(function(t){e[t].valid=null})},validateFieldSet=function(e){return Object.keys(e).every(function(t){return e[t].validate()})},SettingsData={tvq:9.975,tps:5,storeno:"246",storeaddr:"1400, Rue Cyrille-Duquet",storecity:"Québec",storepostcode:"G1X 3S2",storephone:"(418) 527-4114",loaded:!1,loadSettings:function(){var e=localStorage.getItem("settings");return!!e&&(e=JSON.parse(e),this.tvq=e.tvq,this.tps=e.tps,this.storeno=e.storeno,this.storecity=e.storecity,this.storeaddr=e.storeaddr,this.storephone=e.storephone,this.storepostcode=e.storepostcode,!0)},saveSettings:function(){var e={tvq:this.tvq,tps:this.tps,storeno:this.storeno,storecity:this.storecity,storeaddr:this.storeaddr,storephone:this.storephone,storepostcode:this.storepostcode};return e=JSON.stringify(e),localStorage.setItem("settings",e),!0}};SettingsData.loaded=SettingsData.loadSettings();var QuoteData={allquotes:{},openquote:{},loadQuotes:function(){var e=localStorage.getItem("allquotes");return e?(this.allquotes=JSON.parse(e),!0):(this.allquotes={},!1)},deleteQuote:function(e){localStorage.removeItem(e),delete this.allquotes[e],this.saveQuotes()},saveQuotes:function(){var e=JSON.stringify(this.allquotes);return localStorage.setItem("allquotes",e),!0},loadQuote:function(e){var t=localStorage.getItem(e);return t?(this.openquote=JSON.parse(t),this.openquote.date=new Date(this.openquote.date),this.openquote.expires=new Date(this.openquote.expires),!0):(this.openquote={},!1)},saveQuote:function(){if(!this.openquote.id)return!1;var e=JSON.stringify(this.openquote);return localStorage.setItem(this.openquote.id,e),this.allquotes[this.openquote.id]={customer:this.openquote.customer.company},this.saveQuotes(),!0},nextQuoteId:function(){for(var e=SettingsData.storeno,t=new Date,i=String(t.getFullYear()).slice(2,4)+zFill(String(t.getMonth()+1))+zFill(String(t.getDate())),o=1,n=e+i+zFill(o);n in this.allquotes;)n=e+i+zFill(++o);return n},newQuote:function(){var e=new Date,t=new Date(e.getFullYear(),e.getMonth()+1,e.getDate());return this.openquote={id:this.nextQuoteId(),date:e,expires:t,associate:{number:"",name:""},store:{no:SettingsData.storeno,addr:SettingsData.storeaddr,city:SettingsData.storecity+", QC",postcode:SettingsData.storepostcode,phone:SettingsData.storephone},customer:{name:"",company:"",addr:"",city:"",province:"",postcode:"",phone:"",email:""},items:[],notes:""},this.openquote},dateToStr:function(e){return zFill(String(e.getDate()))+"/"+zFill(String(e.getMonth()+1))+"/"+String(e.getFullYear())},strToDate:function(e){return e=e.split("/"),new Date(Number(e[2]),Number(e[1])-1,Number(e[0]))}};QuoteData.loadQuotes();var QuoteHeader=function(e,t){return m("header.hero.is-info.is-bold",[m(".hero-body",m(".container",[m("h1.title.is-1-tablet","Soumissions Staples / Bureau en Gros"),m("h2.subtitle.is-3-tablet","Rédigez vos soumissions rapidement et facilement avec ce petit programme")])),m(".hero-foot",m("nav.tabs.is-boxed.is-hidden-mobile",m("ul",[m("li"+("quotelist"==e?".is-active":""),m('a[href="/"]',{oncreate:m.route.link},[m("span.icon.is-small",m("i.fa.fa-home")),m("span","Mes soumissions")])),m("li"+("newquote"==e?".is-active":""),m('a[href="/new"]',{oncreate:m.route.link},[m("span.icon.is-small",m("i.fa.fa-pencil-square-o")),"newquote"==e&&t?m("span","Modifier la soumission "+t):m("span","Créer une nouvelle soumission")])),m("li"+("settings"==e?".is-active":""),m('a[href="/settings"]',{oncreate:m.route.link},[m("span.icon.is-small",m("i.fa.fa-cog")),m("span","Réglages")]))])))])},QuoteFooter=function(e,t){return m("footer.footer",[m(".container",[m("nav.tabs.is-fullwidth.is-hidden-tablet",m("ul",[m("li"+("quotelist"==e?".is-active":""),m('a[href="/"]',{oncreate:m.route.link},[m("span.icon.is-small",m("i.fa.fa-lg.fa-home")),m("span","Liste")])),m("li"+("newquote"==e?".is-active":""),m('a[href="/new"]',{oncreate:m.route.link},[m("span.icon.is-small",m("i.fa.fa-lg.fa-pencil-square-o")),"newquote"==e&&t?m("span","Modifier"):m("span","Nouvelle")])),m("li"+("settings"==e?".is-active":""),m('a[href="/settings"]',{oncreate:m.route.link},[m("span.icon.is-small",m("i.fa.fa-lg.fa-cog")),m("span","Réglages")]))])),m("content.is-hidden-mobile",m.trust('<strong>Soumissions</strong>, Copyright © 2018 par <a href="https://github.com/jfdesrochers/soumissions">Jean-François Desrochers</a>. Le code source de ce programme est disponible sous la license <a href="http://opensource.org/licenses/mit-license.php">MIT</a>.'))])])},FieldGroup={view:function(e){var t=e.attrs;return m("div.field",[m("label.label"+(t.small?".is-small":""),t.label),t.hasAddons?m("div.field"+(t.hasAddons?".has-addons":""),e.children):e.children,!0===t.isValid&&t.successText?m("p.help.is-success",t.successText):!1===t.isValid&&t.errorText?m("p.help.is-danger",t.errorText):t.helpText?m("p.help",t.helpText):""])}},InputField={oninit:function(e){var t=e.attrs,i=this;i.validated=!1,i.validate=function(){if(!i.validated){var e=t.regEx.test(t.fieldSet[t.name].value);if(e)if("function"==typeof t.filter){var o=t.filter(t.fieldSet[t.name].value,t.regEx);!1===o?e=!1:t.fieldSet[t.name].value=o}else"string"==typeof t.filter&&(t.fieldSet[t.name].value=t.fieldSet[t.name].value.replace(t.regEx,t.filter));return t.fieldSet[t.name].valid=e,e}},i.onChange=function(e){t.fieldSet[t.name].value=e.target.value,i.validate(),i.validated=!0,"function"==typeof t.onChange&&t.onChange(e,t.fieldSet[t.name])},i.onExit=function(){i.validate(),i.validated=!1},t.fieldSet[t.name]||(t.fieldSet[t.name]={value:t.defaultValue,valid:null,validate:i.validate})},view:function(e){var t=e.attrs,i=[m("div.control"+(t.icon?".has-icons-right":"")+(t.fullwidth?".is-expanded":""),[m("input.input"+(t.small?".is-small":"")+(!0===t.fieldSet[t.name].valid?".is-success":!1===t.fieldSet[t.name].valid?".is-danger":""),{oncreate:function(e){t.autofocus&&e.dom.focus()},id:t.name,name:t.name,type:"text",placeholder:t.label,value:t.fieldSet[t.name].value,onchange:this.onChange,onblur:this.onExit,disabled:t.disabled||!1}),t.icon?m("span.icon.is-small.is-right",m("i",{className:t.icon})):""])];if(!0===t.manualGrouping)return i;var o=!1;return Array.isArray(t.manualGrouping)&&(i=i.concat(t.manualGrouping),o=!0),m(FieldGroup,{hasAddons:o,label:t.label,small:t.small,helpText:t.helpText,successText:t.successText,errorText:t.errorText,isValid:t.fieldSet[t.name].valid},i)}},SelectField={oninit:function(e){var t=e.attrs,i=this;i.validate=function(){var e=!0;return"function"==typeof t.onValidate&&(e=t.onValidate(t.fieldSet[t.name].value)),t.fieldSet[t.name].valid=e,e},i.onChange=function(e){t.fieldSet[t.name].value=e.target.value,"function"==typeof t.onChange&&t.onChange(e)},i.onExit=function(){i.validate()},t.fieldSet[t.name]||(t.fieldSet[t.name]={value:t.defaultValue,valid:null,validate:i.validate})},view:function(e){var t=e.attrs,i=[m("div.control"+(t.icon?".has-icons-right":"")+(t.fullwidth?".is-expanded":""),[m("div.select"+(t.small?".is-small":"")+(t.fullwidth?".is-fullwidth":"")+(!0===t.fieldSet[t.name].valid?".is-success":!1===t.fieldSet[t.name].valid?".is-danger":""),[m("select",{oncreate:function(e){t.autofocus&&e.dom.focus()},id:t.name,name:t.name,onchange:this.onChange,onblur:this.onExit,disabled:t.disabled||!1},t.options.map(function(e){return m("option",{value:e.value,selected:t.fieldSet[t.name].value==e.value},e.label)}))]),t.icon?m("span.icon.is-small.is-right",m("i",{className:t.icon})):""])];if(!0===t.manualGrouping)return i;var o=!1;return Array.isArray(t.manualGrouping)&&(i=i.concat(t.manualGrouping),o=!0),m(FieldGroup,{hasAddons:o,label:t.label,small:t.small,helpText:t.helpText,successText:t.successText,errorText:t.errorText,isValid:t.fieldSet[t.name].valid},i)}},QuoteList={};QuoteList.oninit=function(){var e=this;e.deleting="",e.edit=function(e){return function(t){t.preventDefault(),m.route.set("/edit/"+e)}},e.delete=function(t){return function(i){i.preventDefault(),e.deleting=t}},e.confirmdelete=function(t){t.preventDefault(),QuoteData.deleteQuote(e.deleting),e.deleting=""},e.canceldelete=function(t){t.preventDefault(),e.deleting=""}},QuoteList.view=function(){var e=this;return[QuoteHeader("quotelist"),m("div.contents",[m("section.section",[m(".container",[m('a.button.is-primary.is-medium.mb-20[href="/new"]',{oncreate:m.route.link},"Nouvelle Soumission"),m("h1.title.is-4","Soumissions en cours"),m("table.table.is-narrow.is-fullwidth",[m("thead",m("tr",[m("th","No Devis"),m("th","Nom Client"),m("th"),m("th")])),m("tbody",Object.keys(QuoteData.allquotes).length>0?Object.keys(QuoteData.allquotes).map(function(t){return e.deleting===t?m("tr.notification.is-danger.has-text-weight-bold",[m("td","Supprimer?"),m("td",t),m("td",m("a",{onclick:e.confirmdelete},"Supprimer")),m("td",m("a",{onclick:e.canceldelete},"Annuler"))]):m("tr",[m("td",t),m("td",QuoteData.allquotes[t].customer),m("td",m("a.icon.has-text-success",{onclick:e.edit(t)},[m("i.fa.fa-lg.fa-pencil"),m("span.table-button.is-hidden-mobile","Modifier")])),m("td",m("a.icon.has-text-danger",{onclick:e.delete(t)},[m("i.fa.fa-lg.fa-times"),m("span.table-button.is-hidden-mobile","Supprimer")]))])}):m("tr",m("td",{colspan:4},"Aucune soumission en cours.")))])])])]),QuoteFooter("quotelist")]};var NewQuote={};NewQuote.oninit=function(e){var t=this;t.fieldSet={},t.quoteFields={},t.quoteItems=[],t.quotelen=0,t.quoteid=e.attrs.key||null,t.quoteid&&QuoteData.loadQuote(t.quoteid)?(t.quote=QuoteData.openquote,t.quoteItems=[].concat(t.quote.items),t.quotelen=t.quoteItems.length):t.quote=QuoteData.newQuote(),t.isLoading=!1,t.notFound=!1,t.editIndex=-1,t.viewerror="",t.loadSku=function(e,i){if(""!==i.value){t.isLoading=!0,t.notFound=!1;SettingsData.storepostcode.replace(" ","")}},t.lookupAssociate=function(e,i){if(""!==i.value){var o=localStorage.getItem(i.value);if(o){t.fieldSet.assname.value=o;var n=document.getElementById("quotedate");n&&n.focus()}}t.saveFields({saveAssociate:!0})()},t.lookupCustomer=function(e,i){if(""!==i.value){var o=localStorage.getItem(i.value.replace(/\D/g,""));if(o){o=JSON.parse(o);for(var n in o)t.fieldSet[n].value=o[n];var a=document.getElementById("qty");a&&a.focus()}}t.saveFields({saveCustomer:!0})()},t.setEditItem=function(e){return function(i){i.preventDefault(),t.editIndex=e,deserializeFieldSet(t.quoteItems[e],t.quoteFields);var o=document.getElementById("qty");o&&o.focus()}},t.addQuoteItem=function(e){e.preventDefault(),validateFieldSet(t.quoteFields)&&(t.editIndex>-1?t.quoteItems[t.editIndex]=serializeFieldSet(t.quoteFields):(t.quoteItems.push(serializeFieldSet(t.quoteFields)),t.quotelen+=1),t.saveFields()(),t.resetFields(e))},t.deleteItem=function(e){t.editIndex>-1&&(t.quoteItems.splice(t.editIndex,1),t.quotelen-=1,t.saveFields()(),t.resetFields(e))},t.resetFields=function(e){e.preventDefault(),Object.keys(t.quoteFields).forEach(function(e){t.quoteFields[e].value="",t.quoteFields[e].valid=null}),t.quoteFields.qty.value="1",t.quoteFields.rebatetype.value="$",t.editIndex=-1;var i=document.getElementById("qty");i&&i.focus()},t.saveFields=function(e){return e=e||{},function(){var i=serializeFieldSet(t.fieldSet);if(t.quote.associate.name=i.assname,t.quote.associate.number=i.assno,t.quote.customer.name=i.custname,t.quote.customer.company=i.custbusiness,t.quote.customer.addr=i.custaddr,t.quote.customer.city=i.custcity,t.quote.customer.province=i.custprovince,t.quote.customer.postcode=i.custpostcode,t.quote.customer.phone=i.custphone,t.quote.customer.email=i.custemail,t.quote.items=[].concat(t.quoteItems),t.quote.notes=i.quotenotes,QuoteData.saveQuote(),e.saveAssociate&&""!==i.assname&&""!==i.assno&&localStorage.setItem(i.assno,i.assname),e.saveCustomer&&""!==i.custname&&""!==i.custbusiness&&""!==i.custaddr&&""!==i.custcity&&""!==i.custprovince&&""!==i.custpostcode&&""!==i.custphone&&""!==i.custemail){var o=i.custphone.replace(/\D/g,"");localStorage.setItem(o,JSON.stringify({custname:i.custname,custbusiness:i.custbusiness,custaddr:i.custaddr,custcity:i.custcity,custprovince:i.custprovince,custpostcode:i.custpostcode,custphone:i.custphone,custemail:i.custemail}))}}},t.viewquote=function(){var e=validateFieldSet(t.fieldSet);if(t.viewerror="",e)if(t.quotelen>0&&t.quotelen<=18){var i=Object.assign({},t.quote);i.items={},i.items.header=["Qté","No d'UGS","Description","Prix Unitaire","Prix Total"];var o=0;i.items.rows=t.quoteItems.map(function(e){var t="$"===e.rebatetype?parseFloat(e.price)-parseFloat(e.rebatevalue):parseFloat(e.price)-parseFloat(e.price)*(parseFloat(e.rebatevalue)/100),i=t*parseInt(e.qty);return o+=i,[e.qty,e.sku,e.desc,String(t.toFixed(2))+" $",String(i.toFixed(2))+" $"]});for(var n=18-t.quotelen,a=0;a<n;a++)i.items.rows.push(["","","","",""]);var s=o*SettingsData.tps/100,l=o*SettingsData.tvq/100;i.items.rows.push(["","","","Total partiel",String(o.toFixed(2))+" $"]),i.items.rows.push(["","","","TPS",String(s.toFixed(2))+" $"]),i.items.rows.push(["","","","TVQ",String(l.toFixed(2))+" $"]),i.items.rows.push(["","","Ceci n'est pas une facture","Total",String((o+s+l).toFixed(2))+" $"]),location.href="pdfview.html#"+createPDF(i)}else t.viewerror="Votre devis doit contenir un minimum de 1 et un maximum de 18 items!";else t.viewerror="Certains de vos champs contiennent des valeurs invalides! Assurez-vous de bien remplir tous les champs avant de continuer!";""!==t.viewerror&&window.scrollTo(0,document.body.scrollHeight)}},NewQuote.view=function(){var e=this;return[QuoteHeader("newquote",e.quoteid),m("div.contents",[m("section.section",[m(".container",[m(".columns",[m(".column",[m("h1.title",e.quoteid?"Modifier la soumission":"Créer une nouvelle soumission"),m("h2.subtitle","Veuillez remplir les champs de cette page. La soumission sera sauvegardée automatiquement.")]),m(".column.is-3.notification",[m("div.field",[m("label.label.is-small","Numéro du devis"),m("div.control",m("p.is-small",e.quote.id))]),m("div.field",m(".control",m("button.button.is-primary.is-outlined",{onclick:e.viewquote},"Visualiser la soumission")))])])])]),m("section.section.is-small",[m(".container",[m("h1.title.is-4","1. Renseignements Généraux"),m("h2.subtitle.is-6","D'abord, quelques renseignements généraux sur la soumission."),m(".columns",[m(".column",[m(InputField,{name:"assno",label:"Votre numéro d'associé",fieldSet:e.fieldSet,defaultValue:e.quote.associate.number,regEx:/^\d{7}$/,helpText:"Entrez votre numéro d'associé. (ex.: 1234567 ou 0004567)",errorText:"Entrez un numéro d'associé valide. (ex.: 1234567 ou 0004567)",autofocus:!0,onChange:e.lookupAssociate}),m(InputField,{name:"assname",label:"Votre nom",fieldSet:e.fieldSet,defaultValue:e.quote.associate.name,regEx:/^.+$/,filter:titleCase.convert,helpText:"Entrez votre nom complet (prénom et nom)",errorText:"Entrez un nom valide.",onChange:e.saveFields({saveAssociate:!0})})]),m(".column",[m(InputField,{name:"quotedate",label:"Date de la soumission",fieldSet:e.fieldSet,defaultValue:QuoteData.dateToStr(e.quote.date),regEx:/^(0[1-9]|[12][0-9]|3[01])[- /.]?(0[1-9]|1[0-2])[- /.]?((?:19|20)\d\d)$/,filter:function(t,i){return e.quote.date=QuoteData.strToDate(t.replace(i,"$1/$2/$3")),QuoteData.dateToStr(e.quote.date)},helpText:"(jj/mm/aaaa)",errorText:"Entrez une date valide (jj/mm/aaaa).",onChange:e.saveFields()})])])])]),m("section.section.is-small",[m(".container",[m("h1.title.is-4","2. Renseignements sur votre client"),m("h2.subtitle.is-6","Veuillez remplir tous les champs ci-dessous."),m(".columns",[m(".column",[m(".columns",[m(".column",[m(InputField,{name:"custphone",label:"Numéro de téléphone du client",fieldSet:e.fieldSet,defaultValue:e.quote.customer.phone,regEx:/^[(]?(\d{3})[)]?\s?-?\s?(\d{3})\s?-?\s?(\d{4})$/,filter:"($1) $2-$3",helpText:"Entrez le numéro de téléphone de votre client.",errorText:"Entrez un numéro de téléphone valide. (ex.: (555) 555-2345)",onChange:e.lookupCustomer})]),m(".column",[m(InputField,{name:"custemail",label:"Adresse courriel du client",fieldSet:e.fieldSet,defaultValue:e.quote.customer.email,regEx:/^([A-Z|a-z|0-9](\.|_){0,1})+[A-Z|a-z|0-9]\@([A-Z|a-z|0-9])+((\.){0,1}[A-Z|a-z|0-9]){2}\.[a-z]{2,3}$/,helpText:"Entrez l'adresse courriel de votre client.",errorText:"Entrez une adresse courriel valide. (ex.: nom@entreprise.com)",onChange:e.saveFields({saveCustomer:!0})})])]),m(InputField,{name:"custname",label:"Nom de la personne-ressource",fieldSet:e.fieldSet,defaultValue:e.quote.customer.name,regEx:/^.+$/,filter:titleCase.convert,helpText:"Entrez le nom complet (prénom et nom)",errorText:"Entrez un nom valide.",onChange:e.saveFields({saveCustomer:!0})}),m(InputField,{name:"custbusiness",label:"Nom de l'entreprise",fieldSet:e.fieldSet,defaultValue:e.quote.customer.company,filter:function(e){return/[A-Z]+/.test(e)?e:titleCase.convert(e)},helpText:"Entrez le nom de l'entreprise.",errorText:"Entrez un nom valide.",onChange:e.saveFields({saveCustomer:!0})})]),m(".column",[m(InputField,{name:"custaddr",label:"Adresse du client",fieldSet:e.fieldSet,defaultValue:e.quote.customer.addr,regEx:/^\d+\s?.+$/,filter:titleCase.convert,helpText:"Entrez l'adresse de votre client.",errorText:"Entrez une adresse valide.",onChange:e.saveFields({saveCustomer:!0})}),m(".columns",[m(".column",[m(InputField,{name:"custcity",label:"Ville du client",fieldSet:e.fieldSet,defaultValue:e.quote.customer.city,regEx:/^.+$/,filter:titleCase.convert,helpText:"Entrez la ville de votre client.",errorText:"Entrez une ville valide.",onChange:e.saveFields({saveCustomer:!0})})]),m(".column",[m(SelectField,{name:"custprovince",label:"Province du client",fieldSet:e.fieldSet,defaultValue:e.quote.customer.province||"QC",helpText:"Choisissez la province de votre client.",fullwidth:!0,options:[{value:"QC",label:"Québec"},{value:"ON",label:"Ontario"},{value:"NB",label:"Nouveau-Brunswick"},{value:"NS",label:"Nouvelle-Écosse"},{value:"NL",label:"Terre-Neuve et Labrador"},{value:"PEI",label:"Ile du Prince-Édouard"},{value:"MB",label:"Manitoba"},{value:"SK",label:"Saskatchewan"},{value:"AB",label:"Alberta"},{value:"BC",label:"Colombie-Britannique"}],onChange:e.saveFields({saveCustomer:!0})})])]),m(InputField,{name:"custpostcode",label:"Code postal du client",fieldSet:e.fieldSet,defaultValue:e.quote.customer.postcode,regEx:/^([ABCEGHJ-NPRSTVXY]{1}\d{1}[A-Z]{1})\s?(\d{1}[A-Z]{1}\d{1})$/i,filter:function(e,t){return e.replace(t,"$1 $2").toUpperCase()},helpText:"Entrez le code postal de votre client (ex.: H0H 0H0).",errorText:"Entrez un code postal valide (ex.: H0H 0H0).",onChange:e.saveFields({saveCustomer:!0})})])])])]),m("section.section.is-small",[m(".container",[m("h1.title.is-4","3. Items de votre soumission"),e.quotelen<18?m("h2.subtitle.is-6","Vous pouvez ajouter jusqu'à "+(18-e.quotelen)+(17===e.quotelen?" item":" items")+" à votre soumission ci-dessous."):m("h2.subtitle.is-6.has-text-danger","Vous ne pouvez pas ajouter d'items à votre soumission."),m("table#quoteitems.table.is-fullwidth.is-narrow",[m("thead",m("tr",[m("th",m("abbr",{title:"Quantité"},"Qté")),m("th","UGS"),m("th","Description"),m("th",m("abbr",{title:"Prix unitaire"},"Prix")),m("th","Rabais"),m("th","Total"),m("th","")])),m("tbody",e.quoteItems.length>0?e.quoteItems.map(function(t,i){return m("tr"+(e.editIndex===i?".is-selected":""),[m("td",t.qty),m("td",t.sku),m("td",t.desc),m("td",m.trust(t.price+"&nbsp;$")),m("td",m.trust(("$"===t.rebatetype?t.rebatevalue:String((parseFloat(t.price)*(parseFloat(t.rebatevalue)/100)).toFixed(2)))+"&nbsp;$")),m("td",m.trust(("$"===t.rebatetype?String(((parseFloat(t.price)-parseFloat(t.rebatevalue))*parseInt(t.qty)).toFixed(2)):String(((parseFloat(t.price)-parseFloat(t.price)*(parseFloat(t.rebatevalue)/100))*parseInt(t.qty)).toFixed(2)))+"&nbsp;$")),m("td",m("a.icon",{onclick:e.setEditItem(i)},m("i.fa.fa-lg.fa-pencil")))])}):m("tr",m("td",{colspan:8},"Aucun item à afficher.")))]),m(".card",[m("header.card-header",m("p.card-header-title",e.editIndex>-1?"Modifier un item":"Ajouter un item")),m(".card-content",[m(".columns.is-multiline",[m(".column.is-one-quarter",m(InputField,{name:"qty",label:"Quantité",fieldSet:e.quoteFields,defaultValue:"1",regEx:/^[1-9]\d*$/,errorText:"Entrez une quantité valide (> 0).",disabled:e.isLoading})),m(".column.is-one-quarter",m(InputField,{name:"sku",label:"UGS",fieldSet:e.quoteFields,defaultValue:"",regEx:/^.+$/,onChange:e.loadSku,errorText:"Entrez une UGS valide.",helpText:e.notFound?"Item non trouvé!":e.isLoading?"Chargement de l'item...":"",icon:e.isLoading?"fa fa-cog fa-spin":"fa fa-search",disabled:e.isLoading})),m(".column.is-half",m(InputField,{name:"desc",label:"Description",fieldSet:e.quoteFields,defaultValue:"",regEx:/^.+$/,errorText:"Entrez une description valide.",disabled:e.isLoading})),m(".column.is-one-quarter",m(InputField,{name:"price",label:"Prix unitaire",fieldSet:e.quoteFields,defaultValue:"",regEx:/^(\d+)(?:[\,|\.](\d{1,2}))?$/,filter:function(e,t){var i=t.exec(e);return i[1]?i[2]?1==i[2].length?i[1]+"."+i[2]+"0":i[1]+"."+i[2]:i[1]+".00":""},errorText:"Entrez un prix valide. (ex.: 25.00)",disabled:e.isLoading})),m(".column.is-one-quarter",[m(InputField,{manualGrouping:[m(SelectField,{manualGrouping:!0,name:"rebatetype",fieldSet:e.quoteFields,defaultValue:"$",options:[{value:"$",label:"$"},{value:"%",label:"%"}],disabled:e.isLoading})],name:"rebatevalue",label:"Rabais",fieldSet:e.quoteFields,defaultValue:"",fullwidth:!0,regEx:/^(\d+)?(?:[\,|\.](\d{1,2}))?$/,filter:function(e,t){var i=t.exec(e);return i[1]?i[2]?1==i[2].length?i[1]+"."+i[2]+"0":i[1]+"."+i[2]:i[1]+".00":"0.00"},errorText:"Entrez un rabais valide. (ex.: 25.00)",disabled:e.isLoading})])])]),m("footer.card-footer",[e.quotelen<=18||e.editIndex>-1?m("button#addbtn.button.is-white.card-footer-item",{onclick:e.addQuoteItem},e.editIndex>-1?"Sauvegarder":"Ajouter"):"",e.editIndex>-1?m("button#resetbtn.button.is-danger.card-footer-item",{onclick:e.deleteItem},"Supprimer"):"",m("button#resetbtn.button.is-white.card-footer-item",{onclick:e.resetFields},e.editIndex>-1?"Annuler":"Réinitialiser")])])])]),m("section.section.is-small",[m(".container",[m("h1.title.is-4","4. Notes sur la soumission"),m("h2.subtitle.is-6","Si vous le désirez, vous pouvez inclure des notes dans votre devis."),m(InputField,{name:"quotenotes",label:"Notes (optionnel)",fieldSet:e.fieldSet,defaultValue:e.quote.notes,regEx:/^.*$/i,onChange:e.saveFields()})])]),m("section.section.is-not-spaced-top",[m(".container.notification",[e.viewerror?m(".notification.is-danger",e.viewerror):"",m(".field.is-grouped",[m(".control",m("button.button.is-primary",{onclick:e.viewquote},"Visualiser")),m(".control",m('a.button[href="/"]',{oncreate:m.route.link},"Fermer"))])])])]),QuoteFooter("newquote",e.quoteid)]};var Settings={};Settings.oninit=function(){var e=this;e.fieldSet={},e.save=function(){validateFieldSet(e.fieldSet)&&(SettingsData.tvq=parseFloat(e.fieldSet.tvq.value),SettingsData.tps=parseFloat(e.fieldSet.tps.value),SettingsData.storeno=e.fieldSet.storeno.value,SettingsData.storeaddr=e.fieldSet.storeaddr.value,SettingsData.storecity=e.fieldSet.storecity.value,SettingsData.storepostcode=e.fieldSet.storepostcode.value,SettingsData.storephone=e.fieldSet.storephone.value,SettingsData.saveSettings(),SettingsData.loaded=!0,m.route.set("/"))}},Settings.view=function(){return[QuoteHeader("settings"),m("div.contents",[m("section.section",[m(".container",[m("h1.title","Réglages"),m("h2.subtitle","Voici quelques réglages nécessaires à l'opération du programme. SVP remplir tous les champs avant de continuer."),m(".columns",[m(".column",[m(InputField,{name:"storeno",label:"Numéro de magasin",fieldSet:this.fieldSet,defaultValue:SettingsData.storeno,regEx:/^[1-9]{1}\d{0,2}$/,errorText:"Entrez un numéro de magasin valide.",autofocus:!0}),m(InputField,{name:"storeaddr",label:"Adresse du magasin",fieldSet:this.fieldSet,defaultValue:SettingsData.storeaddr,regEx:/^\d+\s?.+$/,filter:titleCase.convert,errorText:"Entrez l'adresse du magasin."}),m(InputField,{name:"storecity",label:"Ville du magasin",fieldSet:this.fieldSet,defaultValue:SettingsData.storecity,regEx:/^.+$/,filter:titleCase.convert,errorText:"Entrez la ville du magasin."}),m(InputField,{name:"storepostcode",label:"Code postal du magasin",fieldSet:this.fieldSet,defaultValue:SettingsData.storepostcode,regEx:/^([ABCEGHJ-NPRSTVXY]{1}\d{1}[A-Z]{1})\s?(\d{1}[A-Z]{1}\d{1})$/i,filter:function(e,t){return e.replace(t,"$1 $2").toUpperCase()},errorText:"Entrez un code postal valide (ex.: H0H 0H0)."}),m(InputField,{name:"storephone",label:"Numéro de téléphone du magasin",fieldSet:this.fieldSet,defaultValue:SettingsData.storephone,regEx:/^[(]?(\d{3})[)]?\s?-?\s?(\d{3})\s?-?\s?(\d{4})$/,filter:"($1) $2-$3",errorText:"Entrez un numéro de téléphone valide (ex.: (555) 555-2345)."})]),m(".column",[m(InputField,{name:"tvq",label:"Taxe de Vente du Québec (%)",fieldSet:this.fieldSet,defaultValue:SettingsData.tvq,regEx:/^\d+(\.\d+)?$/,errorText:"Entrez un pourcentage de taxe valide (ex.: 9.9975)."}),m(InputField,{name:"tps",label:"Taxe des Produits et Services (%)",fieldSet:this.fieldSet,defaultValue:SettingsData.tps,regEx:/^\d+(\.\d+)?$/,errorText:"Entrez un pourcentage de taxe valide (ex.: 5.0)."})])]),m(".field.is-grouped.notification",[m(".control",m("button.button.is-primary",{onclick:this.save},"Sauvegarder")),m(".control",m('a.button[href="/"]',{oncreate:m.route.link},"Annuler"))])])])]),QuoteFooter("settings")]};var version=detectIE(),IEWarning={};if(IEWarning.view=function(){return m("section.hero.is-warning.is-bold",[m(".hero-body",[m(".container",[m("h1.title.is-spaced","Vous utilisez présentement Internet Explorer "+version+"."),m("h2.subtitle","Afin de pouvoir utiliser toutes les fonctionnalités de ce site, nous vous recommandons d'utiliser un navigateur moderne, tel que Google Chrome, Mozilla Firefox ou Microsoft Edge. Voici une sélection de navigateurs que vous pouvez télécharger :")])]),m(".hero-foot",[m(".container",m(".section",[m(".tile.is-ancestor",[m(".tile.is-parent",m('a.tile.is-child.box.has-text-centered[href="https://www.google.fr/intl/fr/chrome/browser/desktop/"]',[m("p.title","Google Chrome"),m("img.browser-logo",{src:"img/ChromeLogo.png"})])),m(".tile.is-parent",m('a.tile.is-child.box.has-text-centered[href="https://www.mozilla.org/fr/firefox/new/"]',[m("p.title","Mozilla Firefox"),m("img.browser-logo",{src:"img/FirefoxLogo.png"})])),m(".tile.is-parent",m('a.tile.is-child.box.has-text-centered[href="http://www.opera.com/fr"]',[m("p.title","Opera"),m("img.browser-logo",{src:"img/OperaLogo.png"})])),m(".tile.is-parent",m('a.tile.is-child.box.has-text-centered[href="https://www.microsoft.com/fr-ca/windows/microsoft-edge"]',[m("p.title","Microsoft Edge"),m("img.browser-logo",{src:"img/EdgeLogo.png"})]))])]))])])},version&&version<10)document.getElementById("approot").innerHTML="<p>Vous utilisez présentement Internet Explorer "+version+'. Ce navigateur n\'est plus supporté par Microsoft et ne fonctionnera pas sur ce site. Veuillez télécharger un navigateur moderne, tel que <a href="https://www.google.fr/intl/fr/chrome/browser/desktop/">Google Chrome</a> ou <a href="https://www.mozilla.org/fr/firefox/new/">Mozilla Firefox</a>. Sinon, copiez l\'URL du site et copiez là dans une appli comme EasyTech en faisant Ctrl + T pour accéder à la version complète de Google Chrome</p>';else if(version&&version<12)m.mount(document.getElementById("approot"),IEWarning);else{var ifSettings=function(e){return{onmatch:function(){return SettingsData.loaded?e:Settings}}};m.route(document.getElementById("approot"),"/",{"/":ifSettings(QuoteList),"/new":ifSettings(NewQuote),"/edit/:key":ifSettings(NewQuote),"/settings":Settings})}